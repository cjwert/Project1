#!/bin/bash

#Christian Wert
#Project 1
#File: alamode-publish

read directory	#get directory path from STDIN (echoed in alamode-fetch)

while getopts ":s:d:" opt; do
	case $opt in
		s)
			sourceDirectory=$OPTARG	 #specifies the directory to look in for the hostfiles containing the data saved by alamode-fetch
			haveSourceDirectory=true
			;;
		d)
			htmlDirectory=$OPTARG	#specifies the directory where the website should be written
			havehtmlDirectory=true
			;;
	esac
done

htmlString="<!DOCTYPE html><html><head><title>Alamode Lab Status</title></head><body><table><tr><th>Hostname</th><th>Users Logged In</th><th>Total Processes</th><th>Running Processes</th><th>Sleeping Processes</th><th>Stopped Processes</th><th>Zombie Processes</th><th>Load Avg Last min</th><th>Load Avg Last 5 min</th><th>Load Avg Last 15 min</th></tr>" #set up html

#cd $directory	#change to directory retrieved from STDIN
for f in $directory/*; do
	array=()
	while read line; do
		array+=("$line")
	done < $f
	echo ${array[*]}
	htmlString=$htmlString"<tr><td>${array[0]}</td><td>${array[1]}</td><td>${array[2]}</td><td>${array[3]}</td><td>${array[4]}</td><td>${array[5]}</td><td>${array[6]}</td><td>${array[7]}</td><td>${array[8]}</td><td>${array[9]}</td></tr>"
done


htmlString=$htmlString"</table></body></html>" #end html
echo $htmlString > "boom.html"
